{
    "$schema": "../../../docs/schema/idoc_v1.json",
    "title": "Month View Events Calendar",
    "dataLoaders": [
        {
            "dataSourceName": "eventsRaw",
            "type": "inline",
            "format": "json",
            "content": [
                {
                    "date": "2025-01-01",
                    "time": "All Day",
                    "title": "New Year's Day",
                    "category": "holiday"
                },
                {
                    "date": "2025-01-06",
                    "time": "09:00",
                    "title": "Team Standup",
                    "category": "meeting"
                },
                {
                    "date": "2025-01-06",
                    "time": "14:00",
                    "title": "Project Review",
                    "category": "work"
                },
                {
                    "date": "2025-01-08",
                    "time": "10:30",
                    "title": "Client Meeting",
                    "category": "meeting"
                },
                {
                    "date": "2025-01-10",
                    "time": "15:00",
                    "title": "Dentist",
                    "category": "personal"
                },
                {
                    "date": "2025-01-13",
                    "time": "09:00",
                    "title": "Standup",
                    "category": "meeting"
                },
                {
                    "date": "2025-01-13",
                    "time": "11:00",
                    "title": "Design Review",
                    "category": "work"
                },
                {
                    "date": "2025-01-15",
                    "time": "13:00",
                    "title": "Lunch w/ Sarah",
                    "category": "personal"
                },
                {
                    "date": "2025-01-17",
                    "time": "16:00",
                    "title": "Code Review",
                    "category": "work"
                },
                {
                    "date": "2025-01-20",
                    "time": "All Day",
                    "title": "MLK Jr. Day",
                    "category": "holiday"
                },
                {
                    "date": "2025-01-20",
                    "time": "09:00",
                    "title": "Standup",
                    "category": "meeting"
                },
                {
                    "date": "2025-01-22",
                    "time": "10:00",
                    "title": "Sprint Planning",
                    "category": "meeting"
                },
                {
                    "date": "2025-01-22",
                    "time": "14:00",
                    "title": "Feature Demo",
                    "category": "work"
                },
                {
                    "date": "2025-01-24",
                    "time": "18:00",
                    "title": "Gym",
                    "category": "personal"
                },
                {
                    "date": "2025-01-27",
                    "time": "09:00",
                    "title": "Standup",
                    "category": "meeting"
                },
                {
                    "date": "2025-01-27",
                    "time": "13:00",
                    "title": "Budget Review",
                    "category": "work"
                },
                {
                    "date": "2025-01-29",
                    "time": "11:00",
                    "title": "1-on-1",
                    "category": "meeting"
                },
                {
                    "date": "2025-01-31",
                    "time": "15:00",
                    "title": "Month End",
                    "category": "work"
                },
                {
                    "date": "2025-02-03",
                    "time": "09:00",
                    "title": "Standup",
                    "category": "meeting"
                },
                {
                    "date": "2025-02-05",
                    "time": "10:00",
                    "title": "Q1 Planning",
                    "category": "meeting"
                },
                {
                    "date": "2025-02-07",
                    "time": "14:00",
                    "title": "Training",
                    "category": "work"
                },
                {
                    "date": "2025-02-10",
                    "time": "09:00",
                    "title": "Standup",
                    "category": "meeting"
                },
                {
                    "date": "2025-02-12",
                    "time": "12:00",
                    "title": "Team Lunch",
                    "category": "personal"
                },
                {
                    "date": "2025-02-14",
                    "time": "All Day",
                    "title": "Valentine's Day",
                    "category": "holiday"
                },
                {
                    "date": "2025-02-14",
                    "time": "19:00",
                    "title": "Dinner Date",
                    "category": "personal"
                },
                {
                    "date": "2025-02-17",
                    "time": "All Day",
                    "title": "Presidents' Day",
                    "category": "holiday"
                },
                {
                    "date": "2025-02-17",
                    "time": "09:00",
                    "title": "Standup",
                    "category": "meeting"
                },
                {
                    "date": "2025-02-19",
                    "time": "10:30",
                    "title": "Arch Review",
                    "category": "work"
                },
                {
                    "date": "2025-02-21",
                    "time": "15:00",
                    "title": "Doctor Appt",
                    "category": "personal"
                },
                {
                    "date": "2025-02-24",
                    "time": "09:00",
                    "title": "Standup",
                    "category": "meeting"
                },
                {
                    "date": "2025-02-26",
                    "time": "11:00",
                    "title": "Product Launch",
                    "category": "work"
                },
                {
                    "date": "2025-02-28",
                    "time": "14:00",
                    "title": "Sprint Retro",
                    "category": "meeting"
                }
            ]
        }
    ],
    "variables": [
        {
            "variableId": "selectedYear",
            "type": "number",
            "initialValue": 2025
        },
        {
            "variableId": "selectedMonth",
            "type": "number",
            "initialValue": 1
        },
        {
            "variableId": "monthName",
            "type": "string",
            "initialValue": "January",
            "calculation": {
                "vegaExpression": "selectedMonth === 1 ? 'January' : selectedMonth === 2 ? 'February' : selectedMonth === 3 ? 'March' : selectedMonth === 4 ? 'April' : selectedMonth === 5 ? 'May' : selectedMonth === 6 ? 'June' : selectedMonth === 7 ? 'July' : selectedMonth === 8 ? 'August' : selectedMonth === 9 ? 'September' : selectedMonth === 10 ? 'October' : selectedMonth === 11 ? 'November' : 'December'"
            }
        },
        {
            "variableId": "eventsGrouped",
            "type": "object",
            "isArray": true,
            "initialValue": [],
            "calculation": {
                "dataSourceNames": [
                    "eventsRaw"
                ],
                "dataFrameTransformations": [
                    {
                        "type": "aggregate",
                        "groupby": [
                            "date"
                        ],
                        "ops": [
                            "values",
                            "values",
                            "values"
                        ],
                        "fields": [
                            "time",
                            "title",
                            "category"
                        ],
                        "as": [
                            "times",
                            "titles",
                            "categories"
                        ]
                    }
                ]
            }
        },
        {
            "variableId": "allDaysOfMonth",
            "type": "object",
            "isArray": true,
            "initialValue": [],
            "calculation": {
                "dataSourceNames": [
                    "eventsRaw"
                ],
                "dataFrameTransformations": [
                    {
                        "type": "sequence",
                        "start": -7,
                        "stop": 39,
                        "as": "dayOffset"
                    },
                    {
                        "type": "formula",
                        "as": "date",
                        "expr": "datetime(selectedYear, selectedMonth - 1, datum.dayOffset)"
                    },
                    {
                        "type": "formula",
                        "as": "dayOfMonth",
                        "expr": "date(datum.date)"
                    },
                    {
                        "type": "formula",
                        "as": "month",
                        "expr": "month(datum.date) + 1"
                    },
                    {
                        "type": "formula",
                        "as": "year",
                        "expr": "year(datum.date)"
                    },
                    {
                        "type": "formula",
                        "as": "dateKey",
                        "expr": "datum.year + '-' + (datum.month < 10 ? '0' + datum.month : datum.month) + '-' + (datum.dayOfMonth < 10 ? '0' + datum.dayOfMonth : datum.dayOfMonth)"
                    },
                    {
                        "type": "formula",
                        "as": "weekday",
                        "expr": "day(datum.date)"
                    },
                    {
                        "type": "formula",
                        "as": "dayName",
                        "expr": "datum.weekday === 0 ? 'sun' : datum.weekday === 1 ? 'mon' : datum.weekday === 2 ? 'tue' : datum.weekday === 3 ? 'wed' : datum.weekday === 4 ? 'thu' : datum.weekday === 5 ? 'fri' : 'sat'"
                    },
                    {
                        "type": "formula",
                        "as": "firstDayWeekday",
                        "expr": "day(datetime(selectedYear, selectedMonth - 1, 1))"
                    },
                    {
                        "type": "formula",
                        "as": "week",
                        "expr": "floor((datum.dayOffset + datum.firstDayWeekday + 7) / 7)"
                    },
                    {
                        "type": "formula",
                        "as": "isCurrentMonth",
                        "expr": "datum.month === selectedMonth ? 1 : 0"
                    }
                ]
            }
        },
        {
            "variableId": "calendarWeeks",
            "type": "object",
            "isArray": true,
            "initialValue": [],
            "calculation": {
                "dataSourceNames": [
                    "allDaysOfMonth"
                ],
                "dataFrameTransformations": [
                    {
                        "type": "formula",
                        "as": "cellDayStr",
                        "expr": "'' + datum.dayOfMonth"
                    },
                    {
                        "type": "collect",
                        "sort": {
                            "field": ["week", "weekday"],
                            "order": ["ascending", "ascending"]
                        }
                    },
                    {
                        "type": "pivot",
                        "groupby": ["week", "isCurrentMonth"],
                        "field": "weekday",
                        "value": "cellDayStr",
                        "op": "max"
                    },
                    {
                        "type": "aggregate",
                        "groupby": ["week"],
                        "ops": ["max", "max", "max", "max", "max", "max", "max", "sum"],
                        "fields": ["0", "1", "2", "3", "4", "5", "6", "isCurrentMonth"],
                        "as": ["0", "1", "2", "3", "4", "5", "6", "currentMonthDays"]
                    },
                    {
                        "type": "collect",
                        "sort": {
                            "field": ["week"],
                            "order": ["ascending"]
                        }
                    }
                ]
            }
        }
    ],
    "groups": [
        {
            "groupId": "header",
            "elements": [
                "# \ud83d\udcc5 Month View Events Calendar",
                "Track your events, meetings, and important dates",
                "",
                "This example demonstrates how to shape data for a calendar view using Vega transforms. Scroll down to see each step of the data transformation pipeline.",
                {
                    "type": "dropdown",
                    "variableId": "selectedMonth",
                    "label": "Month:",
                    "options": [
                        "1",
                        "2",
                        "3",
                        "4",
                        "5",
                        "6",
                        "7",
                        "8",
                        "9",
                        "10",
                        "11",
                        "12"
                    ]
                },
                {
                    "type": "dropdown",
                    "variableId": "selectedYear",
                    "label": "Year:",
                    "options": [
                        "2024",
                        "2025",
                        "2026"
                    ]
                }
            ]
        },
        {
            "groupId": "step1",
            "elements": [
                "## Step 1: Raw Events Data",
                "This is the source data - a flat list of events with dates, times, titles, and categories.",
                {
                    "type": "tabulator",
                    "dataSourceName": "eventsRaw"
                }
            ]
        },
        {
            "groupId": "step2",
            "elements": [
                "## Step 2: Events Grouped by Date",
                "Using `aggregate` transform to group multiple events per day into arrays. Each row now represents one date with arrays of times, titles, and categories.",
                {
                    "type": "tabulator",
                    "dataSourceName": "eventsGrouped"
                }
            ]
        },
        {
            "groupId": "step3",
            "elements": [
                "## Step 3: All Days of Month",
                "Using `sequence` transform to generate all days in the selected month (not just days with events). Computed weekday and week for calendar positioning.",
                {
                    "type": "tabulator",
                    "dataSourceName": "allDaysOfMonth"
                }
            ]
        },
        {
            "groupId": "step5",
            "elements": [
                "## Step 5: Calendar Grid by Week",
                "Final step groups the 42 cells into 6 weeks with 7 columns (Sun-Sat). Each row represents one week of the calendar.",
                {
                    "type": "tabulator",
                    "dataSourceName": "calendarWeeks",
                    "enableDownload": true
                }
            ]
        },
        {
            "groupId": "calendar",
            "elements": [
                "## {{monthName}} {{selectedYear}} - Final Calendar View",
                {
                    "type": "treebark",
                    "variableId": "calendarWeeks",
                    "template": {
                        "div": {
                            "class": "calendar-wrapper",
                            "$children": [
                                {
                                    "table": {
                                        "class": "calendar-table",
                                        "$children": [
                                            {
                                                "thead": {
                                                    "$children": [
                                                        {
                                                            "tr": {
                                                                "$children": [
                                                                    {
                                                                        "th": "Sun"
                                                                    },
                                                                    {
                                                                        "th": "Mon"
                                                                    },
                                                                    {
                                                                        "th": "Tue"
                                                                    },
                                                                    {
                                                                        "th": "Wed"
                                                                    },
                                                                    {
                                                                        "th": "Thu"
                                                                    },
                                                                    {
                                                                        "th": "Fri"
                                                                    },
                                                                    {
                                                                        "th": "Sat"
                                                                    }
                                                                ]
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                "tbody": {
                                                    "$bind": ".",
                                                    "$children": [
                                                        {
                                                            "tr": [
                                                                {
                                                                    "td": "{{0}}"
                                                                },
                                                                {
                                                                    "td": "{{1}}"
                                                                },
                                                                {
                                                                    "td": "{{2}}"
                                                                },
                                                                {
                                                                    "td": "{{3}}"
                                                                },
                                                                {
                                                                    "td": "{{4}}"
                                                                },
                                                                {
                                                                    "td": "{{5}}"
                                                                },
                                                                {
                                                                    "td": "{{6}}"
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            }
                                        ]
                                    }
                                }
                            ]
                        }
                    }
                },
                "### Event Legend",
                "\ud83d\udfe0 **Meeting** \u2022 \ud83d\udd34 **Work** \u2022 \ud83d\udfe3 **Personal** \u2022 \ud83d\udfe2 **Holiday**",
                "",
                "**Data Shaping:** This calendar uses Vega transforms to create a complete calendar grid (42 cells) and join events onto it. Each cell can display up to 3 events, with an indicator for additional events."
            ]
        }
    ]
}