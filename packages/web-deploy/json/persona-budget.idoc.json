{
    "$schema": "../../../docs/schema/idoc_v1.json",
    "title": "Personal Budget Planner",
    "style": {
        "css": [
            "body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background: #f8fafc; }",
            "body { display: grid; grid-template-areas: 'header header header' 'controls controls controls' 'overview allocation trends' 'categories categories categories'; grid-template-columns: 1fr 1fr 1fr; gap: 20px; max-width: 1400px; margin: 0 auto; }",
            ".group { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; }",
            "#header { grid-area: header; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-align: center; }",
            "#controls { grid-area: controls; }",
            "#overview { grid-area: overview; text-align: center; }",
            "#allocation { grid-area: allocation; }",
            "#trends { grid-area: trends; }",
            "#categories { grid-area: categories; }",
            "h1 { margin: 0; padding: 20px 0; font-size: 2em; font-weight: 600; }",
            "h2 { margin: 10px 0; font-size: 2em; color: #2d3748; font-weight: 600; }",
            "h3 { margin: 0 0 15px 0; font-size: 1.2em; color: #4a5568; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px; }",
            ".slider-container { margin: 15px 0; }",
            ".slider-label { font-weight: 500; color: #2d3748; margin-bottom: 8px; display: block; }",
            ".budget-summary { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }",
            ".budget-item { text-align: center; padding: 15px; background: #f7fafc; border-radius: 8px; border: 1px solid #e2e8f0; }",
            ".budget-amount { font-size: 1.8em; font-weight: 600; color: #2d3748; margin: 5px 0; }",
            ".budget-label { font-size: 0.9em; color: #718096; text-transform: uppercase; letter-spacing: 0.5px; }",
            "@media (max-width: 768px) { body { grid-template-columns: 1fr; grid-template-areas: 'header' 'controls' 'overview' 'allocation' 'trends' 'categories'; } }"
        ]
    },
    "dataLoaders": [
        {
            "dataSourceName": "budgetCategories",
            "type": "inline",
            "format": "json",
            "content": [
                {"category": "Housing", "budgeted": 2000, "spent": 1950, "color": "#667eea"},
                {"category": "Food", "budgeted": 600, "spent": 650, "color": "#764ba2"},
                {"category": "Transportation", "budgeted": 400, "spent": 380, "color": "#f093fb"},
                {"category": "Entertainment", "budgeted": 300, "spent": 280, "color": "#4ecdc4"},
                {"category": "Healthcare", "budgeted": 250, "spent": 200, "color": "#45b7d1"},
                {"category": "Savings", "budgeted": 800, "spent": 800, "color": "#96ceb4"},
                {"category": "Utilities", "budgeted": 200, "spent": 180, "color": "#feca57"},
                {"category": "Clothing", "budgeted": 150, "spent": 120, "color": "#ff9ff3"},
                {"category": "Personal Care", "budgeted": 100, "spent": 90, "color": "#54a0ff"}
            ]
        },
        {
            "dataSourceName": "monthlyTrends",
            "type": "inline",
            "format": "json",
            "content": [
                {"month": "2024-01", "Housing": 1980, "Food": 620, "Transportation": 390, "Entertainment": 250, "Healthcare": 180, "Savings": 800, "Utilities": 190, "Clothing": 100, "Personal Care": 80},
                {"month": "2024-02", "Housing": 1950, "Food": 580, "Transportation": 370, "Entertainment": 320, "Healthcare": 220, "Savings": 800, "Utilities": 175, "Clothing": 150, "Personal Care": 95},
                {"month": "2024-03", "Housing": 1950, "Food": 640, "Transportation": 400, "Entertainment": 280, "Healthcare": 160, "Savings": 800, "Utilities": 185, "Clothing": 80, "Personal Care": 85},
                {"month": "2024-04", "Housing": 1950, "Food": 610, "Transportation": 420, "Entertainment": 300, "Healthcare": 240, "Savings": 800, "Utilities": 170, "Clothing": 200, "Personal Care": 110},
                {"month": "2024-05", "Housing": 1950, "Food": 650, "Transportation": 380, "Entertainment": 280, "Healthcare": 200, "Savings": 800, "Utilities": 180, "Clothing": 120, "Personal Care": 90},
                {"month": "2024-06", "Housing": 1950, "Food": 680, "Transportation": 350, "Entertainment": 350, "Healthcare": 190, "Savings": 800, "Utilities": 160, "Clothing": 180, "Personal Care": 100}
            ]
        }
    ],
    "variables": [
        {
            "variableId": "selectedPersona",
            "type": "string",
            "initialValue": "Young Professional"
        },
        {
            "variableId": "monthlyIncome",
            "type": "number",
            "initialValue": 5500
        },
        {
            "variableId": "housingBudget",
            "type": "number",
            "initialValue": 2000
        },
        {
            "variableId": "foodBudget",
            "type": "number",
            "initialValue": 600
        },
        {
            "variableId": "transportationBudget",
            "type": "number",
            "initialValue": 400
        },
        {
            "variableId": "entertainmentBudget",
            "type": "number",
            "initialValue": 300
        },
        {
            "variableId": "savingsBudget",
            "type": "number",
            "initialValue": 800
        },
        {
            "variableId": "adjustedBudgetData",
            "type": "object",
            "isArray": true,
            "initialValue": [],
            "calculation": {
                "dataSourceNames": ["budgetCategories"],
                "dataFrameTransformations": [
                    {
                        "type": "formula",
                        "expr": "datum.category === 'Housing' ? housingBudget : datum.category === 'Food' ? foodBudget : datum.category === 'Transportation' ? transportationBudget : datum.category === 'Entertainment' ? entertainmentBudget : datum.category === 'Savings' ? savingsBudget : datum.budgeted",
                        "as": "adjustedBudget"
                    },
                    {
                        "type": "formula",
                        "expr": "datum.adjustedBudget - datum.spent",
                        "as": "remaining"
                    },
                    {
                        "type": "formula",
                        "expr": "datum.spent / datum.adjustedBudget",
                        "as": "spentPercentage"
                    }
                ]
            }
        },
        {
            "variableId": "totalBudgeted",
            "type": "number",
            "initialValue": 0,
            "calculation": {
                "vegaExpression": "data('adjustedBudgetData') ? data('adjustedBudgetData').reduce((sum, d) => sum + d.adjustedBudget, 0) : 0"
            }
        },
        {
            "variableId": "totalSpent",
            "type": "number",
            "initialValue": 0,
            "calculation": {
                "vegaExpression": "data('adjustedBudgetData') ? data('adjustedBudgetData').reduce((sum, d) => sum + d.spent, 0) : 0"
            }
        },
        {
            "variableId": "totalRemaining",
            "type": "number",
            "initialValue": 0,
            "calculation": {
                "vegaExpression": "totalBudgeted - totalSpent"
            }
        },
        {
            "variableId": "savingsRate",
            "type": "string",
            "initialValue": "0%",
            "calculation": {
                "vegaExpression": "format((savingsBudget / monthlyIncome) * 100, '.1f') + '%'"
            }
        },
        {
            "variableId": "monthlyTrendsLong",
            "type": "object",
            "isArray": true,
            "initialValue": [],
            "calculation": {
                "dataSourceNames": ["monthlyTrends"],
                "dataFrameTransformations": [
                    {
                        "type": "fold",
                        "fields": ["Housing", "Food", "Transportation", "Entertainment", "Healthcare", "Savings", "Utilities", "Clothing", "Personal Care"],
                        "as": ["category", "amount"]
                    }
                ]
            }
        }
    ],
    "groups": [
        {
            "groupId": "header",
            "elements": [
                "# üí∞ Personal Budget Planner",
                "**Interactive budget planning tool for financial wellness**"
            ]
        },
        {
            "groupId": "controls",
            "elements": [
                "### üë§ Persona & Income Settings",
                {
                    "type": "dropdown",
                    "variableId": "selectedPersona",
                    "label": "Select Persona:",
                    "options": ["Young Professional", "Family of 4", "Recent Graduate", "Mid-Career", "Pre-Retirement"]
                },
                {
                    "type": "slider",
                    "variableId": "monthlyIncome",
                    "label": "Monthly Income: ${{monthlyIncome}}",
                    "min": 3000,
                    "max": 10000,
                    "step": 250
                },
                "### üè† Budget Category Adjustments",
                {
                    "type": "slider",
                    "variableId": "housingBudget",
                    "label": "Housing: ${{housingBudget}}",
                    "min": 800,
                    "max": 4000,
                    "step": 50
                },
                {
                    "type": "slider",
                    "variableId": "foodBudget",
                    "label": "Food: ${{foodBudget}}",
                    "min": 200,
                    "max": 1200,
                    "step": 25
                },
                {
                    "type": "slider",
                    "variableId": "transportationBudget",
                    "label": "Transportation: ${{transportationBudget}}",
                    "min": 100,
                    "max": 800,
                    "step": 25
                },
                {
                    "type": "slider",
                    "variableId": "entertainmentBudget",
                    "label": "Entertainment: ${{entertainmentBudget}}",
                    "min": 50,
                    "max": 600,
                    "step": 25
                },
                {
                    "type": "slider",
                    "variableId": "savingsBudget",
                    "label": "Savings: ${{savingsBudget}}",
                    "min": 200,
                    "max": 2000,
                    "step": 50
                }
            ]
        },
        {
            "groupId": "overview",
            "elements": [
                "### üìä Budget Overview",
                "<div class=\"budget-summary\">",
                "<div class=\"budget-item\">",
                "<div class=\"budget-amount\">${{totalBudgeted}}</div>",
                "<div class=\"budget-label\">Total Budgeted</div>",
                "</div>",
                "<div class=\"budget-item\">",
                "<div class=\"budget-amount\">${{totalSpent}}</div>",
                "<div class=\"budget-label\">Total Spent</div>",
                "</div>",
                "</div>",
                "**Monthly Income:** ${{monthlyIncome}}",
                "**Remaining Budget:** ${{totalRemaining}}",
                "**Savings Rate:** {{savingsRate}}"
            ]
        },
        {
            "groupId": "allocation",
            "elements": [
                "### ü•ß Budget Allocation",
                {
                    "type": "chart",
                    "chartKey": "budgetPieChart"
                }
            ]
        },
        {
            "groupId": "trends",
            "elements": [
                "### üìà Spending Trends",
                {
                    "type": "chart",
                    "chartKey": "spendingTrendsChart"
                }
            ]
        },
        {
            "groupId": "categories",
            "elements": [
                "### üìã Category Details",
                {
                    "type": "tabulator",
                    "dataSourceName": "adjustedBudgetData",
                    "tabulatorOptions": {
                        "layout": "fitColumns",
                        "maxHeight": "300px",
                        "columnDefaults": {
                            "headerSort": true
                        },
                        "columns": [
                            {"field": "category", "title": "Category", "width": 150},
                            {"field": "adjustedBudget", "title": "Budgeted", "formatter": "money", "formatterParams": {"symbol": "$"}},
                            {"field": "spent", "title": "Spent", "formatter": "money", "formatterParams": {"symbol": "$"}},
                            {"field": "remaining", "title": "Remaining", "formatter": "money", "formatterParams": {"symbol": "$"}},
                            {"field": "spentPercentage", "title": "% Used", "formatter": "progress", "formatterParams": {"max": 1}}
                        ]
                    }
                }
            ]
        }
    ],
    "resources": {
        "charts": {
            "budgetPieChart": {
                "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
                "width": "container",
                "height": 300,
                "data": {
                    "name": "adjustedBudgetData"
                },
                "mark": {
                    "type": "arc",
                    "innerRadius": 50,
                    "stroke": "white",
                    "strokeWidth": 2
                },
                "encoding": {
                    "theta": {
                        "field": "adjustedBudget",
                        "type": "quantitative",
                        "title": "Budget Amount"
                    },
                    "color": {
                        "field": "category",
                        "type": "nominal",
                        "scale": {
                            "range": ["#667eea", "#764ba2", "#f093fb", "#4ecdc4", "#45b7d1", "#96ceb4", "#feca57", "#ff9ff3", "#54a0ff"]
                        },
                        "legend": {
                            "orient": "right",
                            "title": "Categories"
                        }
                    },
                    "tooltip": [
                        {"field": "category", "type": "nominal", "title": "Category"},
                        {"field": "adjustedBudget", "type": "quantitative", "title": "Budgeted", "format": "$,.0f"},
                        {"field": "spent", "type": "quantitative", "title": "Spent", "format": "$,.0f"},
                        {"field": "remaining", "type": "quantitative", "title": "Remaining", "format": "$,.0f"}
                    ]
                }
            },
            "spendingTrendsChart": {
                "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
                "width": "container",
                "height": 300,
                "data": {
                    "name": "monthlyTrendsLong"
                },
                "mark": {
                    "type": "line",
                    "point": true,
                    "strokeWidth": 2
                },
                "encoding": {
                    "x": {
                        "field": "month",
                        "type": "temporal",
                        "title": "Month",
                        "axis": {
                            "format": "%b %Y"
                        }
                    },
                    "y": {
                        "field": "amount",
                        "type": "quantitative",
                        "title": "Amount Spent ($)"
                    },
                    "color": {
                        "field": "category",
                        "type": "nominal",
                        "scale": {
                            "range": ["#667eea", "#764ba2", "#f093fb", "#4ecdc4", "#45b7d1", "#96ceb4", "#feca57", "#ff9ff3", "#54a0ff"]
                        },
                        "legend": {
                            "title": "Category"
                        }
                    },
                    "tooltip": [
                        {"field": "month", "type": "temporal", "title": "Month", "format": "%B %Y"},
                        {"field": "category", "type": "nominal", "title": "Category"},
                        {"field": "amount", "type": "quantitative", "title": "Amount", "format": "$,.0f"}
                    ]
                }
            }
        }
    }
}